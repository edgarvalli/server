(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{270:function(e,t,n){e.exports=n(518)},275:function(e,t,n){},434:function(e,t){},436:function(e,t){},471:function(e,t){},472:function(e,t){},518:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(23),o=n.n(s),c=(n(275),n(29)),i=n(30),l=n(32),u=n(31),m=n(33),h=n(5),p=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={openDrawer:!1,params:{},credentials:""},n.toggleDrawer=function(){return n.setState({openDrawer:!n.state.openDrawer})},n.showSearchBar=function(){var e=document.querySelector("#search-bar-container");e.classList.contains("search-bar-show")?e.classList.remove("search-bar-show"):e.classList.add("search-bar-show")},n.setParams=function(e){return n.setState({params:e})},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){"credentials"in navigator?this.setState({credentials:"Credentials API is supported"}):this.setState({credentials:"Credentials API is not supported"})}},{key:"changeView",value:function(e){this.props.navigation.go(e),this.toggleDrawer()}},{key:"logout",value:function(){window.confirm("\xbfDeseas cerrar sesi\xf3n?")?(localStorage.clear(),sessionStorage.clear(),window.location.reload()):this.toggleDrawer()}},{key:"toggleFullScreen",value:function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(h.a,{position:"fixed"},r.a.createElement(h.u,{className:"navbar"},r.a.createElement(h.l,{onClick:this.toggleDrawer},"menu"),r.a.createElement(h.v,{variant:"h6",color:"inherit"},this.state.params.title),r.a.createElement(h.l,{onClick:this.showSearchBar},"search"),r.a.createElement("div",{className:"search-bar",id:"search-bar-container"},r.a.createElement(h.l,{color:"action",onClick:this.showSearchBar},"arrow_back"),r.a.createElement("input",{type:"search",id:"search-bar",placeholder:this.state.params.placeholder||"Buscador"})))),r.a.createElement(h.r,{open:this.state.openDrawer,onClose:this.toggleDrawer,onOpen:this.toggleDrawer},r.a.createElement(h.m,null,r.a.createElement(h.n,null,r.a.createElement(h.o,null,r.a.createElement(h.b,{src:"https://lh3.googleusercontent.com/-zjdfJx44dfQ/AAAAAAAAAAI/AAAAAAAAAos/SukJQdVUzJU/s60-p-rw-no-il/photo.jpg"})),r.a.createElement(h.q,null,"Edgar Eduardo Valli Mu\xf1oz"))),r.a.createElement(h.h,null),r.a.createElement(h.m,{className:"w-drawer"},r.a.createElement(h.n,{onClick:function(){return e.changeView("Clients")}},"Clientes"),r.a.createElement(h.n,{onClick:function(){return e.logout()}},"Cerrar Session"),r.a.createElement(h.n,{onClick:function(){return e.toggleFullScreen()}},"FullScreen"),r.a.createElement(h.n,null,r.a.createElement(h.v,{variant:"caption"},this.state.credentials)))))}}]),t}(a.Component),d=n(19),f=n.n(d),g=n(27),v="ckUQU!@YtN%8Phtp9tXtC6W96PeV8Kd4mcMpB==Bs9JUK8B=*JKNX!C$K%3a",b="https://ev-server.ddns.net/api/tlacrm",w=n(120),k=n.n(w),E=function(e){var t="https://ev-server.ddns.net/api/tlacrm/users/login",n=localStorage.getItem("session")||sessionStorage.getItem("session"),a={headers:{"Content-Type":"Application/Json",Accept:"Application/Json"},method:"get"};return n&&(n=JSON.parse(n),a.headers.Token=n.token),{authentication:function(){var e=Object(g.a)(f.a.mark(function e(n,r){var s,o,c;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.method="post",a.body=JSON.stringify(n),e.next=4,fetch(t,a).catch(function(e){return console.log(e)});case 4:return s=e.sent,e.next=7,s.json();case 7:(o=e.sent).error&&alert(o.message),r?(c=new k.a(v),localStorage.setItem("loggedIn",!0),localStorage.setItem("currentView","Clients"),localStorage.setItem("session",JSON.stringify({username:n.username,password:c.encrypt(n.password),token:o.token,autoLogin:!0}))):(sessionStorage.setItem("loggedIn",!0),sessionStorage.setItem("currentView","Clients"),sessionStorage.setItem("session",JSON.stringify({token:o.token})));case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),loginAgain:function(){var e=Object(g.a)(f.a.mark(function e(){var r,s,o,c;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new k.a(v),s={username:n.username,password:r.decrypt(n.password)},a.method="post",a.body=JSON.stringify(s),e.next=6,fetch(t,a).catch(function(e){return console.log(e)});case 6:return o=e.sent,e.next=9,o.json();case 9:(c=e.sent).error&&alert(c.message),console.log(c),n.token=c.token,console.log(n),localStorage.setItem("session",JSON.stringify(n));case 15:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),get:function(){var t=Object(g.a)(f.a.mark(function t(){var r,s;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,a).catch(function(e){return console.log(e)});case 2:return r=t.sent,t.next=5,r.json();case 5:if(!(s=t.sent).error){t.next=11;break}if(!s.tokenExpired){t.next=11;break}if(!n.autoLogin){t.next=11;break}return t.next=11,this.loginAgain();case 11:return t.abrupt("return",s);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),post:function(){var t=Object(g.a)(f.a.mark(function t(r){var s,o;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.method="post",a.body=JSON.stringify(r),t.next=4,fetch(e,a).catch(function(e){return console.log(e)});case 4:return s=t.sent,t.next=7,s.json();case 7:if(!(o=t.sent).error){t.next=13;break}if(!o.tokenExpired){t.next=13;break}if(!n.autoLogin){t.next=13;break}return t.next=13,this.loginAgain();case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),uploadFile:function(){var e=Object(g.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},y=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={username:"",password:"",autoLogin:!1},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"login",value:function(){var e=Object(g.a)(f.a.mark(function e(t){var n,a,r,s;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=this.state,a=n.username,r=n.password,s=n.autoLogin,"https://ev-server.ddns.net/api/tlacrm/users/login",e.next=5,E("https://ev-server.ddns.net/api/tlacrm/users/login").authentication({username:a,password:r},s);case 5:window.location.reload();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("form",{onSubmit:function(t){return e.login(t)},className:"login-container"},r.a.createElement("div",{className:"bg-login"}),r.a.createElement(h.d,null,r.a.createElement(h.g,null),r.a.createElement(h.f,null,r.a.createElement(h.t,{label:"Usuario",fullWidth:!0,value:this.state.username,onChange:function(t){return e.setState({username:t.target.value})},tabIndex:1}),r.a.createElement(h.t,{label:"Contrase\xf1a",type:"password",fullWidth:!0,value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},tabIndex:2})),r.a.createElement(h.e,null,r.a.createElement(h.k,{container:!0},r.a.createElement(h.k,{item:!0,xs:3}),r.a.createElement(h.k,{item:!0,xs:6},r.a.createElement(h.j,{control:r.a.createElement(h.s,{value:!0,color:"primary",onChange:function(t){return e.setState({autoLogin:t.target.checked})}}),label:"Auto Login",tabIndex:3})),r.a.createElement(h.k,{item:!0,xs:3}),r.a.createElement(h.k,{item:!0,xs:12},r.a.createElement(h.c,{fullWidth:!0,variant:"contained",color:"primary",type:"submit"},"Login"))))))}}]),t}(a.Component),x=function(e){return e.clients.map(function(e){return r.a.createElement(h.m,{key:e._id},r.a.createElement(h.n,{onClick:function(){return function(e){var t=document.getElementById(e);"expanded"===t.getAttribute("status")?(t.style.height=0,t.setAttribute("status","collapsed")):(t.style.height="8rem",t.setAttribute("status","expanded"))}(e._id)},className:"touchable"},r.a.createElement(h.q,null,e.name),r.a.createElement(h.p,null,r.a.createElement(h.l,null,"keyboard_arrow_down"))),r.a.createElement(S,{client:e}))})},S=function(e){var t=e.client;return r.a.createElement("div",{className:"expanded",id:t._id,status:"collapsed"},["Llamar","Mostrar Presupuestos","Mostrar Trabajos","Eliminar"].map(function(e,n){return r.a.createElement(h.v,{variant:"caption",key:e+n,onClick:function(){return function(e){switch(e){case 0:window.open("tel:+52 ".concat(t.cellphone),"_blank");break;case 1:case 2:case 3:break;default:return null}}(n)},className:"touchable"},e)}))},j=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={clients:[]},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.navigation.setNavbarParams({title:"Clientes",placeholder:"Buscar Cliente"}),document.querySelector("#search-bar").addEventListener("keyup",function(t){return e.searchClients(t.target.value)}),this.fetchClients()}},{key:"fetchClients",value:function(){var e=Object(g.a)(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(b,"/clients/fetch/1"),e.next=3,E(t).get();case 3:if(!(n=e.sent).error){e.next=6;break}return e.abrupt("return",alert(n.message));case 6:this.setState({clients:n.data.clients});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchClients",value:function(){var e=Object(g.a)(f.a.mark(function e(t){var n,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t){e.next=2;break}return e.abrupt("return",this.fetchClients());case 2:return n="".concat(b,"/clients/search/").concat(t),e.next=5,E(n).get();case 5:if(!(a=e.sent).error){e.next=8;break}return e.abrupt("return",alert(a.message));case 8:this.setState({clients:a.data.clients});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container"},r.a.createElement(h.k,{container:!0},r.a.createElement(h.k,{item:!0,xs:12},r.a.createElement(h.m,{component:"nav"},r.a.createElement(x,{clients:this.state.clients})))),r.a.createElement("span",{className:"fab-fixed"},r.a.createElement(h.i,{color:"primary","aria-label":"Add",onClick:function(){return e.props.navigation.go("Jobs")}},r.a.createElement(h.l,null,"add"))))}}]),t}(a.Component),O=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.navigation.setNavbarParams({title:"Clientes"})}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},"Hello")}}]),t}(a.Component),C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={views:{Login:y,Clients:j,Jobs:O},currentView:"Clients",params:{},loggedIn:!1,isMobile:!1},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){this.breakPoints(),"true"===(localStorage.getItem("loggedIn")||sessionStorage.getItem("loggedIn"))?this.setState({loggedIn:!0,currentView:localStorage.getItem("currentView")}):this.setState({loggedIn:!1})}},{key:"breakPoints",value:function(){var e=window.innerWidth;/Mobile/.test(navigator.userAgent)?this.setState({isMobile:!0}):e>768&&this.setState({isMobile:!0})}},{key:"render",value:function(){var e=this,t=this.state,n=t.views,a=t.currentView,s=t.isMobile,o=n[a],c={go:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.setState({currentView:t,params:n})},setNavbarParams:function(t){return e.refs.navbar.setParams(t)},isMobile:s};return this.state.loggedIn?r.a.createElement("div",null,r.a.createElement(p,{ref:"navbar",navigation:c}),r.a.createElement(o,{navigation:c})):r.a.createElement(y,null)}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(C,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[270,2,1]]]);
//# sourceMappingURL=main.3c3f96e9.chunk.js.map